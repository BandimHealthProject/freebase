
<html>
<!--
This file is automatically generated and all changes will be overwritten














-->
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<script type="text/javascript" src="/coldchain/system/js/odkCommon.js"></script>
		<script type="text/javascript" src="/coldchain/system/js/odkData.js"></script>
		<script type="text/javascript" src="/coldchain/system/tables/js/odkTables.js"></script>
		<script type="text/javascript" src="formgen_common.js"></script>
		<script type="text/javascript" src="generate_common.js"></script>
		<link href="generate_detail.css" rel="stylesheet" />
		<style>
#rest {
	display: none;
}
body {
	font-family: arial;
}
.h4-wrapper {
	margin-top: 1.5em;
	text-align: center;
	display: block;
	/* wrapper height 45px, text height 25px */
	height: 45px;
	line-height: 45px; /* TEST for vertical center */
	background: linear-gradient(indianred, lightcoral);
}
h4 {
	display: inline-block;
	height: 25px;
	margin: 0px 0px;
	color: #eeeeee;
}
.main-col-wrapper {
	background: repeating-radial-gradient(mediumaquamarine, lightseagreen, teal);
	box-shadow: 0 2px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
	color: white;
	border-bottom: none !important;
	margin-top: 3.5em;
	text-align: center;
	font-size: 150%;
	/*line-height: 1.5em;*/
	padding-top: 1em;
	padding-bottom: 1em;
}
@media screen and (min-width: 480px) {
	.main-col-wrapper {
		/*line-height: 4em;*/
	}
}

button {
	/*margin-top: -4em;*/
	padding: 1em 10%;
	border: 2px solid teal;
	border-radius: 10px;
	background-color: lightsegreen;
}
.li-inner {
	border-bottom: 2px solid teal
}
li {
	/*margin-top: 10px;*/
	margin-bottom: 20px;
	padding-bottom: 5px;
	break-inside: avoid-column;
	-webkit-column-break-inside: avoid;
	display: block;
}

@media screen and (min-width: 480px) {
	ul {
		columns: 2;
		-webkit-columns: 2;
	}
}
ul {
	list-style-type: none;
	padding-left: 20px;
	padding-right: 20px;
}
.main-col-wrapper > div {
	border-bottom-style: none;
}
#edit {
	margin-left: 8px;
}
#main-col {
	display: none;
}

		</style>
		<script>
// A map of table ids to their instance columns (or _id if we couldn't pull it)
var display_cols = {"refrigerators": "tracking_id", "health_facility": "facility_name", "m_logs": "date_serviced", "refrigerator_types": "model_id"}
// List of tables to edit with formgen. If a table isn't found in this list, we edit it with survey instead
var allowed_tables = ["refrigerators", "health_facility", "m_logs", "refrigerator_types"];
var customJsOl = function customJsOl() {
	var generic_callback = function generic_callback(e, c, d, which, pretty, optional_col_name) {
	if (optional_col_name == null || optional_col_name == undefined || typeof(optional_col_name) != "string") {
		optional_col_name = displayCol(which, d.getMetadata(), d.getTableId());
	} else {
		optional_col_name = _tu(optional_col_name);
	}
	wrapper = function(i) { return _tc(d, which, i); };
	if (pretty) wrapper = function(i) { return window.pretty(_tc(d, which, i.toString())); };
	if (c == null) c = "null"; // because null.toString() will throw an exception
	document.getElementById("inject-" + which).innerHTML = "<b>" + optional_col_name + "</b>: " + wrapper(c);
	document.getElementById("inject-" + which).classList.add("li-inner");
}
var build_generic_callback = function build_generic_callback(which, pretty, optional_col_name) {
	return function _generic_callback_wrapper(e, c, d) {
		if (typeof(pretty) == "string") {
			c = c + pretty;
			pretty = false;
		}
		if (typeof(pretty) == "function") {
			c = pretty(c)
			pretty = false;
		}
		return generic_callback(e, c, d, which, pretty, optional_col_name);
	}
}
allowed_tables = [];

	document.getElementById("bfi").innerText = _tu("Basic Refrigerator Information")
	var model_callback = function model_callback(e, c, d) {
		var btn = document.getElementById("open_model");
		btn.innerText = _tu("Model Information");
		var model = d.getData(0, "catalog_id"); // from join, not actually the model id
		var model_row_id = d.getData(0, "model_row_id");
		btn.disabled = false;
		btn.addEventListener("click", function() {
			odkTables.openDetailView(null, "refrigerator_types", model_row_id);
		});
		build_generic_callback("model_id", true, _tu("Model ID"))(e, c, d)
		return "";
	}
	var hf_callback = function hf_callback(e, c, d) {
		/*
			var btn = document.getElementById("open_hf");
			btn.innerText = _tu("Health Facility Information");
			var hf = d.getData(0, "facility_name"); // from join, not actually the hf id
			var hf_row_id = d.getData(0, "facility_row_id");
			btn.disabled = false;
			btn.addEventListener("click", function() {
				odkTables.openDetailView(null, "health_facility", hf_row_id, "config/assets/aa_health_facility_detail.html#health_facility/" + hf_row_id);
			});
		*/
		build_generic_callback("facility_name", true, "Facility")(e, c, d)
		document.getElementById("add_m_log").disabled = false;
		document.getElementById("add_m_log").innerText = _tu("Add Maintenance Record");
		var defaults = {"refrigerator_id": d.getData(0, "refrigerator_id"), "date_serviced": odkCommon.toOdkTimeStampFromDate(new Date())};
		document.getElementById("add_m_log").addEventListener("click", function add_m_log() {
			if (allowed_tables.indexOf("m_logs") >= 0) {
				var id = newGuid();
				odkData.addRow("m_logs", defaults, id, function() {
					// Escape the LIMIT 1
					odkData.arbitraryQuery("m_logs", "UPDATE m_logs SET _savepoint_type = ? WHERE _id = ?;--", ["INCOMPLETE", id], 100, 0, function success(d) {
						odkTables.launchHTML({}, "config/assets/formgen/m_logs#" + id);
					}, null);
				});
			} else {
				odkTables.addRowWithSurvey({}, "m_logs", "m_logs", null, defaults);
			}
		});
		document.getElementById("view_m_log").disabled = false;
		document.getElementById("view_m_log").innerText = _tu("View all maintenance logs")
		document.getElementById("view_m_log").addEventListener("click", function add_m_log() {
			odkTables.launchHTML(null, "config/assets/aa_m_logs_list.html#m_log/STATIC/SELECT *, refrigerators.refrigerator_id AS refs_refid, refrigerators.tracking_id AS refs_tracking_number FROM m_logs JOIN refrigerators ON refrigerators.refrigerator_id = m_logs.refrigerator_id WHERE refs_refid = ?/" + JSON.stringify([d.getData(0, "refrigerator_id")]) + "/maintenance records for the selected refrigerator");
		});

		return "";
	}

	main_col = "";
	global_join = "refrigerator_types ON refrigerators.model_row_id = refrigerator_types._id JOIN health_facility ON refrigerators.facility_row_id = health_facility._id"
	global_which_cols_to_select = "*"
	var subquery = "(SELECT date_serviced FROM m_logs WHERE m_logs.refrigerator_id = refrigerators.refrigerator_id AND m_logs._savepoint_type != 'INCOMPLETE' ORDER BY date_serviced DESC LIMIT 1)"
	global_which_cols_to_select = global_which_cols_to_select.concat(", (CASE WHEN "+subquery+" IS NOT NULL THEN "+subquery+" ELSE 'No Records' END) as date_serviced")
	colmap = [
		["facility_name", hf_callback],
		["year", build_generic_callback("year", true, "Year Installed")],
		["working_status", build_generic_callback("working_status", true, "Status")],
		["reason_not_working", build_generic_callback("reason_not_working", true)],
		["model_row_id", model_callback],
		["tracking_id", build_generic_callback("tracking_id", false, "Tracking Number")],
		["voltage_regulator", build_generic_callback("voltage_regulator", true)],
		//["refrigerator_id", build_generic_callback("refrigerator_id", true)],
		["date_serviced", build_generic_callback("date_serviced", function(i) {
			if (i == "No Records") {
				return _tu(i);
			}
			return i.split("T")[0];
		}, _tu("Date Serviced"))]
	];

}

		</script>
		<script type="text/javascript" src="generate_detail.js"></script>
	</head>
	<body onLoad='ol();'>
		<div id="header">
			<button id="back" onClick='odkCommon.closeWindow();'></button>
			<button id="delete" onClick='_delete();' disabled></button>
			<button id="edit" onClick='edit();' disabled></button>
			<span id="main-col"></span>
		</div>
		<ul id="rest">Loading...</ul>

	<div class="main-col-wrapper">
		<div id="inject-tracking_id">Loading...</div>
	</div>
	<div class='h4-wrapper'><h4 id='bfi'><h4></div>
	<ul>
		<li id='inject-facility_name'></li>
		<li id='inject-year'></li>
		<li id='inject-working_status'></li>
		<li id='inject-reason_not_working'></li>
		<li id='inject-model_id'></li>
		<!--
			<li id='inject-tracking_id'></li>
		-->
		<li id='inject-voltage_regulator'></li>
		<li id='inject-date_serviced'></li>
	</ul>
	<button disabled id='open_model'></button>
	<!--
		<br />
		<button disabled id='open_hf'></button>
	-->
	<br />
	<button disabled id='add_m_log'></button>
	<br />
	<button disabled id='view_m_log'></button>
	<br />
		
	</body>
</html>